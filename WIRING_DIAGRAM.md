# 蝴蝶孵化箱接线图

本文档详细说明ESP32-C3与各元器件的连接方式。

## 元器件清单

- ESP32-C3 开发板 × 1
- AM2302 温湿度传感器 × 1
- OLED 0.96 SSD1306 显示屏 × 1
- 继电器模块 × 2（用于控制加热垫和加湿器）
- 按键 × 3（设置、增加、减少）
- 4.7kΩ 电阻 × 1（AM2302上拉电阻）
- 220V加热垫 × 1
- 5V电风扇 × 1
- 加湿器 × 1

## ESP32-C3引脚说明

ESP32-C3开发板常用GPIO引脚：
- GPIO 0: BOOT按钮（某些板子），可用作普通GPIO
- GPIO 1: 可用
- GPIO 2: 可用（推荐用于传感器）
- GPIO 3: 可用
- GPIO 4: 可用（I2C SDA）
- GPIO 5: 可用（I2C SCL）
- GPIO 6: 可用
- GPIO 7: 可用
- GPIO 8: USB D-（通常避免使用）
- GPIO 9: USB D+（通常避免使用）
- GPIO 10: 可用

## 详细接线说明

### 1. AM2302 温湿度传感器

```
AM2302          ESP32-C3
─────────────────────────
VCC (红线)  →  3.3V
DATA (黄线) →  GPIO 2
GND (黑线)  →  GND
                │
                └─ 4.7kΩ电阻 → 3.3V (上拉电阻)
```

**注意事项：**
- AM2302的DATA引脚需要4.7kΩ上拉电阻连接到3.3V
- 如果使用AM2302模块（带PCB），通常已内置上拉电阻
- 确保传感器供电稳定（3.3V或5V，根据模块规格）

### 2. OLED SSD1306 显示屏

```
OLED SSD1306    ESP32-C3
─────────────────────────
VCC         →  3.3V (或5V，根据模块)
GND         →  GND
SDA         →  GPIO 4
SCL         →  GPIO 5
```

**注意事项：**
- OLED模块通常已内置I2C上拉电阻
- 如果使用5V供电的OLED，确保ESP32-C3的GPIO可以承受5V（通常可以）
- I2C地址通常是0x3C，某些模块可能是0x3D

### 3. 继电器模块（加热垫控制）

```
继电器模块      ESP32-C3          220V加热垫
─────────────────────────────────────────────
VCC         →  5V (或3.3V)
GND         →  GND
IN          →  GPIO 6
                │
                └─ 控制信号
                    │
220V电源 ──┬── COM (公共端)
          │
          └── NO (常开端) ──→ 加热垫火线
          
加热垫零线 ──→ 220V电源零线
```

**安全警告：**
- ⚠️ **220V高压危险！** 必须由专业电工操作
- 确保所有220V连接牢固可靠
- 使用符合规格的继电器（建议10A以上）
- 安装漏电保护器
- 确保继电器模块与ESP32完全隔离

### 4. 继电器模块（加湿器控制）

```
继电器模块      ESP32-C3          加湿器
─────────────────────────────────────────
VCC         →  5V (或3.3V)
GND         →  GND
IN          →  GPIO 7
                │
                └─ 控制信号
                    │
220V电源 ──┬── COM (公共端)
          │
          └── NO (常开端) ──→ 加湿器火线
          
加湿器零线 ──→ 220V电源零线
```

### 5. 5V电风扇

```
5V风扇          ESP32-C3
─────────────────────────
红色线(+)   →  5V (或通过继电器控制)
黑色线(-)   →  GND
                │
PWM控制线    →  GPIO 10 (PWM控制)
```

**可选方案：**
- **方案A（直接PWM控制）**：如果风扇支持PWM调速，直接连接到GPIO 10
- **方案B（通过继电器）**：如果风扇不支持PWM，使用第三个继电器模块控制开关

### 6. 按键（设置、增加、减少）

```
按键            ESP32-C3
─────────────────────────
设置按键
  一端      →  GPIO 0
  另一端    →  GND
  
增加按键
  一端      →  GPIO 1
  另一端    →  GND
  
减少按键
  一端      →  GPIO 3
  另一端    →  GND
```

**注意事项：**
- 按键使用内部上拉电阻（INPUT_PULLUP模式）
- 按键按下时，GPIO读取为LOW（低电平）
- 如果GPIO 0是BOOT按钮，可能需要调整引脚

## 电源供电

### ESP32-C3供电

```
ESP32-C3
─────────────────────────
USB-C接口  →  5V USB电源适配器
或
VIN引脚    →  5V电源（如果使用外部电源）
```

### 继电器模块供电

```
继电器模块
─────────────────────────
VCC        →  5V (从ESP32-C3的5V引脚或外部5V电源)
GND        →  GND (与ESP32-C3共地)
```

**注意事项：**
- 如果使用多个继电器，确保电源容量足够
- 建议使用外部5V电源为继电器模块供电，避免从ESP32-C3取电

### 传感器和OLED供电

```
AM2302 / OLED
─────────────────────────
VCC        →  3.3V (从ESP32-C3的3.3V引脚)
GND        →  GND (与ESP32-C3共地)
```

## 完整接线示意图

```
                    ┌─────────────────┐
                    │   ESP32-C3      │
                    │                 │
     AM2302 ────────┤ GPIO2           │
     (DATA)         │                 │
                    │ GPIO4 ──── SDA  │─── OLED
                    │ GPIO5 ──── SCL  │
                    │                 │
    按键(设置) ─────┤ GPIO0           │
    按键(增加) ─────┤ GPIO1           │
    按键(减少) ─────┤ GPIO3           │
                    │                 │
    继电器1(IN) ────┤ GPIO6 ──── 加热垫
    继电器2(IN) ────┤ GPIO7 ──── 加湿器
                    │                 │
    风扇(PWM) ──────┤ GPIO10          │
                    │                 │
                    │ 3.3V  GND 5V    │
                    └─────────────────┘
                         │   │   │
                         │   │   │
                    ┌────┘   │   └────┐
                    │        │        │
                  AM2302   OLED    继电器模块
                  OLED              风扇
```

## 接线检查清单

在通电前，请检查：

- [ ] AM2302的DATA引脚已连接4.7kΩ上拉电阻（如果模块没有内置）
- [ ] 所有GND已正确连接并共地
- [ ] 电源电压正确（ESP32-C3使用5V，传感器使用3.3V）
- [ ] 220V电路连接牢固，无裸露导线
- [ ] 继电器模块与ESP32-C3完全隔离
- [ ] 所有连接牢固，无松动
- [ ] I2C设备（OLED）地址正确（通常是0x3C）
- [ ] 按键连接正确（一端接GPIO，一端接GND）

## 安全注意事项

### ⚠️ 高压安全

1. **220V电路必须由专业电工操作**
2. 确保所有高压连接牢固可靠
3. 使用符合规格的继电器（建议10A以上）
4. 安装漏电保护器
5. 确保继电器模块与低压电路完全隔离

### ⚠️ 防火安全

1. 加热垫不要直接接触易燃物
2. 定期检查线路和连接
3. 不要在无人看管时长时间运行
4. 确保加湿器有足够的水，避免干烧

### ⚠️ 设备保护

1. 确保所有元器件供电电压正确
2. 避免短路
3. 使用合适的保险丝
4. 定期检查连接

## 测试步骤

1. **先测试低压部分**（不连接220V设备）：
   - 上传代码
   - 检查OLED是否显示
   - 检查传感器是否读取数据
   - 检查按键是否响应

2. **测试继电器**（不连接220V负载）：
   - 观察继电器指示灯
   - 检查继电器是否正常开关

3. **最后连接220V设备**：
   - 在专业电工指导下连接
   - 逐步测试每个设备
   - 观察系统运行状态

## 故障排除

### 传感器无数据
- 检查DATA引脚连接
- 检查上拉电阻
- 检查供电电压

### OLED无显示
- 检查I2C连接（SDA/SCL）
- 检查I2C地址
- 检查供电

### 继电器不工作
- 检查控制引脚连接
- 检查继电器模块供电
- 检查继电器模块指示灯

### 按键无响应
- 检查按键连接
- 检查GPIO引脚配置
- 检查内部上拉电阻是否启用

